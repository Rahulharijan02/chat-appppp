{% extends 'social/base.html' %}
{% load static humanize %}
{% block content %}
<div class="row g-4">
  <div class="col-lg-3 d-none d-lg-block">
    <div class="card fb-card">
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <div class="avatar-circle me-2">{{ user.username|first|upper }}</div>
          <div>
            <div class="fw-semibold">{{ user.username }}</div>
            <div class="text-muted small">{{ user.profile.job_title|default:'Share your role' }}</div>
          </div>
        </div>
        <div class="list-group list-group-flush">
          <a class="list-group-item list-group-item-action d-flex align-items-center" href="{% url 'profile' user.username %}"><i class="bi bi-person-fill me-2 text-primary"></i>Profile</a>
          <a class="list-group-item list-group-item-action d-flex align-items-center" href="{% url 'chat_list' %}"><i class="bi bi-messenger me-2 text-primary"></i>Messenger</a>
          <a class="list-group-item list-group-item-action d-flex align-items-center" href="/feed/"><i class="bi bi-newspaper me-2 text-primary"></i>News Feed</a>
        </div>
      </div>
    </div>
  </div>

  <div class="col-lg-6">
    <div class="card fb-card mb-3">
      <div class="card-body">
        <div class="d-flex align-items-center mb-3">
          <div class="avatar-circle me-2">{{ user.username|first|upper }}</div>
          <div class="text-muted">What's on your mind, {{ user.username }}?</div>
        </div>
        <form method="post" action="{% url 'create_post' %}">
          {% csrf_token %}
          {{ post_form.media }}
          <div class="mb-3">{{ post_form.message }}</div>
          <div class="d-flex align-items-center justify-content-between">
            <div class="small text-muted">Visibility: {{ post_form.visibility }}</div>
            <button class="btn btn-primary rounded-pill px-4" type="submit"><i class="bi bi-send-fill me-1"></i>Post</button>
          </div>
        </form>
      </div>
    </div>

    {% for post in posts %}
      <div class="card fb-card mb-3">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div class="d-flex align-items-center">
              <div class="avatar-circle me-2">{{ post.author.username|first|upper }}</div>
              <div>
                <div class="fw-semibold">{{ post.author.username }}</div>
                <small class="text-muted">{{ post.created_at|naturaltime }}</small>
              </div>
            </div>
            <span class="badge bg-light text-dark border">{{ post.visibility|capfirst }}</span>
          </div>
          <p class="card-text mt-3 mb-2">{{ post.message }}</p>
          <div class="d-flex align-items-center gap-3 text-muted small">
            <span><i class="bi bi-hand-thumbs-up-fill text-primary me-1"></i>{{ post.likes.count }} likes</span>
            <span><i class="bi bi-chat-left-text me-1"></i>{{ post.comments.count }} comments</span>
          </div>
          <hr>
          <div hx-target="this" hx-swap="outerHTML">
            {% include 'social/components/like_button.html' %}
          </div>
          <div class="mt-3" hx-target="this" hx-swap="outerHTML">
            {% include 'social/components/comments.html' %}
          </div>
        </div>
      </div>
    {% empty %}
      <p>No posts yet. Share your first update!</p>
    {% endfor %}
  </div>

  <div class="col-lg-3">
    <div class="card fb-card mb-3">
      <div class="card-body">
        <h6 class="fw-semibold">Friend requests</h6>
        {% for request in friend_requests %}
          <div class="d-flex justify-content-between align-items-center border rounded p-2 mb-2">
            <div class="d-flex align-items-center">
              <div class="avatar-circle me-2">{{ request.sender.username|first|upper }}</div>
              <span>{{ request.sender.username }}</span>
            </div>
            <div class="btn-group btn-group-sm">
              <a class="btn btn-primary" href="{% url 'respond_friend_request' request.pk 'accept' %}">Confirm</a>
              <a class="btn btn-outline-secondary" href="{% url 'respond_friend_request' request.pk 'decline' %}">Delete</a>
            </div>
          </div>
        {% empty %}
          <p class="text-muted mb-0">You're all caught up.</p>
        {% endfor %}
      </div>
    </div>
    <div class="card fb-card">
      <div class="card-body">
        <h6 class="fw-semibold">About you</h6>
        <p class="mb-1"><i class="bi bi-geo-alt me-2 text-primary"></i>{{ user.profile.location|default:'Add a location' }}</p>
        <p class="mb-1"><i class="bi bi-briefcase me-2 text-primary"></i>{{ user.profile.job_title|default:'Add your job title' }}</p>
        <p class="mb-3"><i class="bi bi-info-circle me-2 text-primary"></i>{{ user.profile.bio|default:'Add a quick introduction on your profile.' }}</p>
        <a href="{% url 'profile' user.username %}" class="btn btn-outline-primary btn-sm rounded-pill">Edit profile</a>
      </div>
    </div>
  </div>
</div>
{% endblock %}
